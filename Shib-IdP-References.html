<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Multipass and Cloud Init Examples</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Multipass and Cloud Init Examples</h1>
</header>
<p>This is a collection of links that may be helpful if you’re setting
up a Shibboleth IdP 4 service.</p>
<ul>
<li>https://shibboleth.atlassian.net/wiki/spaces/IDP4/overview</li>
<li>https://github.com/ConsortiumGARR/idem-tutorials/blob/master/idem-fedops/HOWTO-Shibboleth/Identity%20Provider/Debian-Ubuntu/HOWTO%20Install%20and%20Configure%20a%20Shibboleth%20IdP%20v4.x%20on%20Debian-Ubuntu%20Linux%20with%20Apache2%20%2B%20Jetty9.md
<ul>
<li>this one was actually pretty useful in figuring things out but it
did not conform to the path of using stock Ubuntu 20.04 LTS packages as
much as possible</li>
</ul></li>
<li>https://cloudinfrastructureservices.co.uk/install-shibboleth-sso-on-ubuntu-20-04/
<ul>
<li>useful overview, particularly the opening diagram</li>
<li>focus is on Tomcat not Jetty (which is recommended)</li>
</ul></li>
<li>https://registry.idem.garr.it/idem-conf/shibboleth/IDP4/apache2/idp.example.org.conf
<ul>
<li>Starting point of figuring out what should be in our site
configuration for our Apache 2 idp.example.edu virtual host file</li>
</ul></li>
<li>https://www.baeldung.com/deploy-to-jetty
<ul>
<li>General description of deploying to Jetty</li>
</ul></li>
<li>Documentation for Shibboleth IdP 3 that setup
<ul>
<li>https://www.switch.ch/aai/guides/idp/installation/
<ul>
<li>uses Postgres to manage the accounts</li>
</ul></li>
</ul></li>
<li>Example Shibboleth SP setups
<ul>
<li><a
href="https://iam.harvard.edu/resources/saml-shibboleth-integration">harvard</a></li>
<li><a href="https://shibboleth.usc.edu/docs/sp/install/">USC</a></li>
</ul></li>
</ul>
<h1 id="configuring-our-idp">Configuring our IdP</h1>
<ul>
<li>https://shibboleth.atlassian.net/wiki/spaces/IDP4/pages/1265631611/PasswordAuthnConfiguration</li>
<li>https://shibboleth.atlassian.net/wiki/spaces/IDP4/pages/1274544392/HTPasswdAuthnConfiguration
<ul>
<li>this documents using an Apache htpasswd type file</li>
</ul></li>
</ul>
<h2 id="cut-text-save-if-i-need-later">cut text, save if I need
later</h2>
<p>——– START CUT ——————– The is hinted at in two places of the
Shibboleth confluence documentation site: <a
href="https://shibboleth.atlassian.net/wiki/spaces/IDP4/pages/1265631611/PasswordAuthnConfiguration">PasswordAuthentication</a>
and <a
href="https://shibboleth.atlassian.net/wiki/spaces/IDP4/pages/1274544392/HTPasswdAuthnConfiguration">HTPasswdAuthnConfiguration</a>.
The later actually shows an example of what needs to change in the
“bean” element so the Java class and use the htpasswd file. Unfortunetly
that is about all it shows. In the former page there is a mention of a
<code>modules.sh</code> program to enable modules like Password base
authentication. Fortunately that does respond to the
<code>--help</code>. Based on that I know their example is first tests
if the module is already enabled and stops or proceeds to enable it
(we’ll also going to enable the “Hello World” flow to support
testing).</p>
<pre class="shell"><code>    sudo su
    cd /opt/shibboleth-idp
    ./bin/module.sh -t idp.authn.Password
    ./bin/module.sh -e idp.authn.Password</code></pre>
<p>In comment the
<code>&lt;bean parent="shibboleth.HTPasswdValidator" p:resource="%{idp.home}/credentials/demo.htpasswd" /&gt;</code>
and save the file.</p>
<pre class="shell"><code>    vi conf/authn/password-authn-config.xml</code></pre>
<p>You can create our <code>demo.htpasswd</code> file in
<code>credentials/demo.htpasswd</code> using Apache
<code>htpasswd</code> program. That file needs to be owned by
<code>jetty.adm</code>.</p>
<pre><code>   htpasswd -c credentials/demo.htpasswd testuser
   chown jetty:adm credentials/demo.htpasswd
   chmod 660 credentials/demo.htpasswd</code></pre>
<p>The “views” or HTML pages supplied by Shibboleth are found in the
“views” directory. At this point you should see ones for
<code>login.vm</code> as well as other parts of the “flow” like
<code>logout.vm</code> and <code>login-error.vm</code>.</p>
<p>But, at least in my build the test does actually detact that is
enabled. Run the command separately yields better results and ensure
0that the login view have been created.</p>
<p>Checking the <code>/idp/status</code> end point to make sure the IdP
software is working, we can then try the</p>
<p>If we see the Shibboleth IdP 4 status page we’re ready to proceed to
setting up Apache 2 as a reverse proxy for our IdP.</p>
<p>——– END CUT ———————-</p>
</body>
</html>
